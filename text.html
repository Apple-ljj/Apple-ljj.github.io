<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>测试页</title>
 <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
</head>
<style type="text/css">
*{
margin:0px;
padding:0px;
}
	.sys{
		 text-align: center;
		 font-size: 20px;
		 color: red;
		    font-size: 0.34rem;
	}
	#div{
		width: 90%;
 		padding: 0.2rem 0px; 
 		margin: 200px auto; 
		background: #0090ff;
		text-align: center;
		color: #fff;
		font-size: 0.34rem;
		border-radius: 10px; 
	}
	#cover{
		width: 100%;
		height: 100%;
		position:absolute;
		top:0%;
		left:0%;
		background: rgba(0,0,0,.7);
		display: none;
	}
</style>
<body οnlοad="countTime()">
	<p class="sys"></p>
	  <div id="time2"></div>
	  <div id="time"></div>
	<div id="div">
		点击返回APP
	</div>
	<div id="cover">
	
	</div>
<script src="https://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<!-- <script src="/common.js"></script> -->

<script type="text/javascript">
$(function(){
	var adios=isos();
	var isWeiXin=isWeiXin();
	var userId=geturl("userId");
	var url="";
// 	alert(geturl("id"));
	if(isWeiXin){
		$("#cover").show();
	}
	if(adios=="1"){
		url=window.location.href="mnjz://myhost/open/goodsdetail?goods_id=10"
		$(".sys").html("当前系统安卓")
	}else if(adios=="2"){
		url=window.location.href = 'iOSTencentTest://goodsDetails?id=123456'
		$(".sys").html("当前系统苹果")
	}
	$("#div").on("click",function () {
		window.location=url;
	})
function geturl() {
	     reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)","i");
	     r = window.location.search.substr(1).match(reg);
	     if (r!=null) return (r[2]); return null;
}
//判断是否是微信浏览器的函数
function isWeiXin(){
	  var ua = window.navigator.userAgent.toLowerCase();
	  if(ua.match(/MicroMessenger/i) == 'micromessenger'){
	  	return true;
	  }else{
	  	return false;
	  }
}
 function isos() {
 	var u = navigator.userAgent;
 	if(u.indexOf('Android') > -1 || u.indexOf('Linux') > -1){
  		return 1;
 	}else if(u.indexOf('iPhone') > -1){
 		return 2;
 	}else{
 		return 3;
 	}
 }
 /*
 2017-01-04 by xw
 获取倒计时 返回值数字

 t1 开始时 时间格式
 t2 结束时 时间格式
 tg 要获取的值 字符串
   d 天
   h 时
   m 分
   s 秒
 */
//  var starttime = new Date("2019-09-13 16:40:00");
//  function tt(){
//      var nowtime = new Date();
//      //alert(nowtime);
//      var time = starttime - nowtime;
//      var day = parseInt(time / 1000 / 60 / 60 / 24);//天
//      var hour = parseInt(time / 1000 / 60 / 60 % 24);//小时
//      var minute = parseInt(time / 1000 / 60 % 60);//分钟
//      var seconds = parseInt(time / 1000 % 60);//秒
     
//      if(hour<=0 && minute<=0 && seconds<=0){
//          clearInterval(sj);
//          $('.nlpz_sjdjs').html("活动已结束");
//      }else{
//          $('.nlpz_sjdjs').html('剩余:'+'<span>'+day+'天</span>:'+'<span>'+hour+'时</span>'+':'+'<span>'+minute+'分</span>'+':'+'<span>'+seconds+'秒</span>');
//      } 
//  }
//  var sj = setInterval(function () {tt();}, 1000);

var star=new Date('2019-09-2 16:40:00');
// var end=new Date('2019-09-6 16:40:00');
var end ='2019-09-06 18:30:30'
// var thistime=new Date();
// if(star.getTime()>thistime.getTime()){
// 	alert("活动未开始");
// }else if(end.getTime()<thistime.getTime()){
// 	alert("活动结束");
// }else{
// 	alert("进行中");
// }
// function freshTime(){
//     var endtime=end
//     var nowtime=new Date();
//     var lefttime=parseInt(endtime.getTime()-nowtime.getTime());//这是毫秒，如果再/1000就是秒
//     // 获取剩下的日、小时、分钟、秒钟
//     // 一天有多少毫秒，一小时有多少毫秒，一分钟有多少毫秒，一秒钟有多少毫秒
//     var dm=24*60*60*1000;
//     var d=parseInt(lefttime/dm);
//     var hm=60*60*1000;
//     var h=parseInt((lefttime/hm)%24);
//     var mm=60*1000;
//     var m=parseInt((lefttime/mm)%60);
//     var s=parseInt((lefttime/1000)%60);
//     m=checktime(m);
//     s=checktime(s);
//     document.getElementById('LeftTime').innerHTML=d+"天"+h+"小时"+m+"分钟"+s+"秒";
//     if (lefttime<0) {
//          document.getElementById('LeftTime').innerHTML="团购活动已经结束！";
//     }
//    } 
//    freshTime();
//    var sh;
//    sh=setInterval('freshTime()',1000)
/* http://quan.suning.com/getSysTime.do */
// 	 	$.ajax({
//            url:"http://quan.suning.com/getSysTime.do",
//            type:'get',
//            dataType:'JSON',
//            success:function (res) {
//         		sysTime1=res.sysTime1;
//         		sysTime2=res.sysTime2;
//         		sysTime=new Date(sysTime2).getTime()
//         		localTime=new Date().getTime();
//         		console.log(sysTime,localTime);
        		
//           },
//            error:function(err){  
//                 console.log(err);  
//            }  
//         })
link="https://quan.suning.com/getSysTime.do";
sysTimes='';
countDown(end)
//获取苏宁当前时间
function sysTime(){
 	$.ajax({
        url:link,
        type:'get',
        dataType:'JSON',
        async:false,
        success:function (res) {
		$("#time2").html(res);
        	sysTimes=res.sysTime2;
       },
        error:function(err){ 
        	  window.location.reload();
             console.log(err);  
        }  
     })
}
 function countDown(end) {
	sysTime();
    var endTime = new Date(end.replace(/-/g, '/')).getTime();
    var nowTime = new Date(sysTimes.replace(/-/g, '/')).getTime();
    var total_second = endTime - nowTime;
    dateformat(total_second)
    if (total_second <= 0) {
    	$("#time").html("活动已结束");
    }
    setTimeout(function () {
        countDown(end);
    }, 1000)
}
function dateformat(micro_second) {
    // 总秒数
    var second = Math.floor(micro_second / 1000);
    // 天数
    var day = Math.floor(second / 3600 / 24);
    // 小时
    var hr = Math.floor(second / 3600 % 24);
    var hrStr = hr.toString();
    if (hrStr.length == 1) hrStr = '0' + hrStr;  
    // 分钟
    var min = Math.floor(second / 60 % 60);
    var minStr = min.toString();
    if (minStr.length == 1) minStr = '0' + minStr; 
    // 秒
    var sec = Math.floor(second % 60);
    var secStr = sec.toString();
    if (secStr.length == 1) secStr = '0' + secStr; 
    if (day <= 1) {
//         return "剩 " + hrStr + ":" + minStr + ":" + secStr;
    	$("#time").html(hrStr + "时" + minStr + "分" + secStr+"秒");
    } else {
//         return "剩 " + day + " 天 " + hrStr + ":" + minStr + ":" + secStr;
    	$("#time").html(day + " 天 " +hrStr + "时" + minStr + "分" + secStr+"秒");
    }
}
})
</script>
</body>
</html>
